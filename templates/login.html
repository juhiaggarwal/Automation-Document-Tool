<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      background: linear-gradient(135deg, #dbeafe, #fce7f3);
    }
    .dark-mode {
      background: #121212;
      color: #ffffff;
    }
       /* REMOVE this block completely or modify it */
.swal2-popup {
  transition: none !important; /* ‚ö†Ô∏è Remove this unless necessary */
}

/* Adjust buttons instead of stripping everything */
.swal2-actions button {
  transition: all 0.2s ease; /* smoother but not disabling everything */
}

    .login-form {
      max-width: 440px;
      margin: 80px auto;
      background: #ffffff;
      border-radius: 18px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .dark-mode .login-form {
      background: #1f1f1f;
      color: white;
    }
    .dark-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 999;
    }
    .social-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ddd;
      background: white;
      color: #333;
      font-weight: 500;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 12px;
      text-decoration: none;
    }
    .social-btn:hover {
      background: #f1f1f1;
    }
    .social-btn img {
      height: 22px;
      margin-right: 12px;
    }
    #assistantPrompt {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      cursor: pointer;
      display: none;
      align-items: center;
      background: #f0f8ff;
      border: 1px solid #007bff;
      padding: 10px 16px;
      border-radius: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      font-weight: 500;
      color: #007bff;
      font-size: 1rem;
    }
    #assistantPrompt .robot {
      font-size: 1.6rem;
      margin-right: 10px;
    }
    .chat-assistant {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 260px;
      height: 300px;
      border-radius: 12px;
      border: 1px solid #ccc;
      background: #fff;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      font-size: 0.85rem;
      z-index: 998;
    }
    .chat-box {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
    }
    .chat-input {
      display: flex;
      border-top: 1px solid #ccc;
    }
    .chat-input input {
      flex: 1;
      padding: 8px;
      border: none;
    }
    .chat-input button {
      padding: 8px 12px;
      background: #007bff;
      color: white;
      border: none;
    }
    .highlight-link {
      color: #007bff;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
    }

       /* your current styles... */

  /* === FIX BLINKING ON SWEETALERT BUTTONS === */
  .swal2-popup,
  .swal2-modal,
  .swal2-confirm,
  .swal2-cancel {
    transition: none !important;
    animation: none !important;
  }

  .swal2-actions button,
  .swal2-actions button:hover,
  .swal2-actions button:focus {
    transition: none !important;
    animation: none !important;
    outline: none !important;
    box-shadow: none !important;
    background-color: #3085d6 !important;
    color: white !important;
  }

  .swal2-cancel:hover,
  .swal2-cancel:focus {
    background-color:gray !important;
    color: white !important;
  }

  </style>
</head>
<body>
  <button class="btn btn-outline-secondary dark-toggle" onclick="toggleDarkMode()">üåô</button>

  <div class="login-form">
    <h4 class="text-center mb-4">Login to Your Account</h4>
    <form id="loginForm">
      <input name="email" type="email" class="form-control mb-3" placeholder="Email Address" required>
      <div class="input-group mb-3">
        <input name="password" type="password" id="passwordInput" class="form-control" placeholder="Password" required>
        <span class="input-group-text" onclick="togglePassword('passwordInput', 'eyeIcon')">
          <i class="fa-solid fa-eye" id="eyeIcon"></i>
        </span>
      </div>
      <button class="btn btn-primary w-100 mb-3" type="submit">Login</button>
      <div class="mb-3 text-center">
        <a class="highlight-link" onclick="promptReset()">Forgot Password? Reset here</a>
      </div>
      <div class="text-center my-3 text-muted">---------------- OR ----------------</div>
      <a href="/login/google" class="social-btn">
        <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/google/google-original.svg" />
        Continue with Google
      </a>
      <a href="/login/github" class="social-btn">
        <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" />
        Login with GitHub
      </a>
      <p class="mt-3 text-center">
        Don't have an account? <a href="/register" class="highlight-link">Register</a>
      </p>
    </form>
  </div>

  <!-- Robot prompt -->
  <div id="assistantPrompt" onclick="toggleChat()">
    <div class="robot">ü§ñ</div>
    How can I help you?
  </div>

  <!-- Chat assistant -->
  <div class="chat-assistant" id="chatbox">
    <div class="chat-box" id="chatBox">
      <div><strong>Assistant:</strong> Hi! How can I assist you today?</div>
    </div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Ask something..." />
      <button onclick="sendMessage()">‚û§</button>
    </div>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', () => {
  const prompt = document.getElementById('assistantPrompt');

  setTimeout(() => {
    if (prompt) prompt.style.display = 'flex';

    // Only for first-time visitors
    if (!localStorage.getItem('assistantGreeted')) {
      const speak = () => {
        const msg = new SpeechSynthesisUtterance("Hello, how can I help you?");
        msg.lang = 'en-US';
        msg.volume = 1;
        msg.pitch = 1;
        msg.rate = 1;

        try {
          speechSynthesis.cancel();
          speechSynthesis.speak(msg);
        } catch (e) {
          console.warn("Speech blocked or failed:", e);
        }

        localStorage.setItem('assistantGreeted', 'true');
        document.removeEventListener('click', speak); // remove fallback
      };

      // Try speaking immediately (may fail)
      speak();

      // Fallback: speak on first click if blocked
      document.addEventListener('click', speak, { once: true });
    }
  }, 1000);
});


    function toggleChat() {
      const chatbox = document.getElementById('chatbox');
      chatbox.style.display = (chatbox.style.display === 'none' || chatbox.style.display === '') ? 'flex' : 'none';
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }


    
document.getElementById("chatInput").addEventListener("keypress", function (e) {
  if (e.key === "Enter") {
    e.preventDefault();
    sendMessage();
  }
});

document.getElementById("loginForm").addEventListener("submit", async function (e) {
  e.preventDefault();
  const formData = new FormData(this);
  try {
    const response = await fetch("/login", {
      method: "POST",
      body: formData
    });
    const result = await response.json();
    if (response.ok) {
      Swal.fire({
        icon: "success",
        title: "Login Successful!",
        text: result.message,
        timer: 2000,
        showConfirmButton: false
      }).then(() => {
        window.location.href = "/dashboard";
      });
    } else {
      Swal.fire({
        icon: "error",
        title: "Login Failed",
        text: result.message
      });
    }
  } catch (error) {
    Swal.fire({
      icon: "error",
      title: "Server Error",
      text: "Please try again later."
    });
  }
});

    function togglePassword(inputId, iconId) {
      const input = document.getElementById(inputId);
      const icon = document.getElementById(iconId);
      input.type = input.type === "password" ? "text" : "password";
      icon.classList.toggle("fa-eye-slash");
      icon.classList.toggle("fa-eye");
    }

    function sendMessage() {
      const input = document.getElementById("chatInput");
      const message = input.value.trim();
      if (!message) return;
      const box = document.getElementById("chatBox");
      box.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
      fetch("/chat", {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ query: message })
      })
      .then(res => res.json())
      .then(data => {
        box.innerHTML += `<div><strong>Assistant:</strong> ${data.response || "No response"}</div>`;
        box.scrollTop = box.scrollHeight;
      });
      input.value = "";
    }
  function promptReset() {
  Swal.fire({
    title: 'Enter your registered email',
    input: 'email',
    inputPlaceholder: 'Email address',
    showCancelButton: true,
    confirmButtonText: 'Reset Password',
    showLoaderOnConfirm: true,

    preConfirm: (email) => {
  if (!email) {
    Swal.showValidationMessage("Please enter an email.");
    return false;
  }

  return fetch("/reset-password", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({email})
  })
  .then(res => {
    if (!res.ok) throw new Error("Network response was not ok");
    return res.json();
  })
  .then(data => {
    if (!data.success) {
      throw new Error(data.message || "Reset failed.");
    }
    return data;
  })
  .catch(err => {
    Swal.showValidationMessage(err.message || "Unexpected error.");
    throw err; // ‚úÖ CRITICAL LINE TO FIX BLINKING
  });
},

    allowOutsideClick: () => !Swal.isLoading()
  }).then((result) => {
    if (result.isConfirmed && result.value) {
      Swal.fire("‚úÖ Success", "Password reset email sent!", "success");
    }
  });
}
  </script>
</body>
</html>
